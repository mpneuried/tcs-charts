!function(){var a,b,c=function(a,b){return function(){return a.apply(b,arguments)}},d=[].slice;b=a=function(){function a(a){var b;this.target=a,this._extend=c(this._extend,this),this.define=c(this.define,this),this.setter=c(this.setter,this),this.getter=c(this.getter,this);try{Object.defineProperty(this,"testIE",{get:function(){return!1}})}catch(d){return b=d,new Error("browser-outdated","tcs-charts not availible on IE8 and lower.")}}return a.prototype.defaults={},a.prototype.getter=function(a,b,c){null==c&&(c=this),Object.defineProperty(c,a,{get:b})},a.prototype.setter=function(a,b,c){null==c&&(c=this),Object.defineProperty(c,a,{set:b})},a.prototype.define=function(a,b,c){Object.defineProperty(c,a,b)},a.prototype._extend=function(){var a,b,c,e,f,g;for(c=1<=arguments.length?d.call(arguments,0):[],f=0,g=c.length;g>f;f++){b=c[f];for(a in b)e=b[a],c[0][a]=e}return c[0]},a}(),null!=("undefined"!=typeof module&&null!==module?module.exports:void 0)?module.exports=b:(window.tcscharts||(window.tcscharts={}),window.tcscharts.Base=b)}.call(this),function(){var a,b,c,d=function(a,b){return function(){return a.apply(b,arguments)}},e={}.hasOwnProperty,f=function(a,b){function c(){this.constructor=a}for(var d in b)e.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};null!=("undefined"!=typeof module&&null!==module?module.exports:void 0)?(b=require("./base.js"),this.d3=require("d3")):b=window.tcscharts.Base,c=a=function(a){function b(a,c,e){var f,g,h=this;return this.target=a,null==c&&(c=0),this.tweenNeedle=d(this.tweenNeedle,this),this.tween=d(this.tween,this),this._set=d(this._set,this),this._getColorByFactor=d(this._getColorByFactor,this),this._getAngleByFactor=d(this._getAngleByFactor,this),this._calcNeedle=d(this._calcNeedle,this),this.create=d(this.create,this),this._arc=d(this._arc,this),this._radToAngle=d(this._radToAngle,this),this._angleToRad=d(this._angleToRad,this),this._initOption=d(this._initOption,this),this._initOptions=d(this._initOptions,this),g=b.__super__.constructor.call(this,this.target),this._initOptions(e,!0),f={get:function(){return 100*h._value},set:function(a){a>1&&(a/=100),h._set(a)}},this.define("value",f,this),this.value=c,this.create(),g}return f(b,a),b.prototype.defaults={width:500,margin:0,startAngle:-75,endAngle:75,thicknessFactor:.8,needleLengthFactor:null,bgColor:"#ddd",needleColor:"#333",fixedColor:null,startColor:"#B4EB57",endColor:"#D10000",animationDuration:500},b.prototype._rad=2*Math.PI/360,b.prototype._initOptions=function(a,b){var c;if(null==b&&(b=!1),b&&this._extend(this.opt={},this.defaults,a),this.opt.height=this.opt.width/2,b)for(c in this.opt)this._initOption(c)},b.prototype._initOption=function(a){var b,c=this;return b={get:function(){return"needleLengthFactor"===a&&null==c.opt[a]?c.opt.thicknessFactor:c.opt[a]},set:function(b){switch(c.opt[a]=b,a){case"width":case"needleLengthFactor":case"thicknessFactor":c._initOptions(null),c.create();break;case"animationDuration":case"startColor":case"endColor":break;default:c.create()}}},this.define(a,b,this)},b.prototype._angleToRad=function(a){return this._rad*a},b.prototype._radToAngle=function(a){return a/this._rad},b.prototype._arc=function(a){var b;return b=d3.svg.arc().outerRadius(this.opt.width/2.05).innerRadius(this.opt.width/6/this.opt.thicknessFactor).startAngle(this._angleToRad(this.opt.startAngle)),null!=a&&b.endAngle(this._angleToRad(a)),b},b.prototype.create=function(){var a;a=d3.select(this.target),a.select("svg").remove(),this.svg=a.append("svg").attr("height",this.opt.height+2*this.opt.margin).attr("width",this.opt.width+2*this.opt.margin).append("g").attr("transform","translate("+this.opt.margin+","+this.opt.margin+")"),this.bg=this.svg.append("path").style("fill",this.opt.bgColor).attr("class","bg").attr("transform","translate("+this.opt.height+","+this.opt.height+")").attr("d",this._arc(this.opt.endAngle)),this.color=this.svg.append("path").attr("class","color").attr("transform","translate("+this.opt.height+","+this.opt.height+")").datum({endAngle:this._angleToRad(this._getAngleByFactor(this._value)),fill:this._getColorByFactor(this._value)}).attr("d",this.arc=this._arc()),null!=this.opt.fixedColor&&this.color.attr("fill",this.opt.fixedColor),this.opt.neelde||(this.needle=this.svg.append("path").style("fill",this.opt.needleColor).attr("class","needle").datum({angle:this._getAngleByFactor(this._value)}).attr("d",this._calcNeedle()).attr("transform","rotate("+this._getAngleByFactor(0)+" "+this.opt.height+" "+this.opt.height+")")),this._set(this._value)},b.prototype._calcNeedle=function(){var a,b;return b=this.opt.width,a=this.opt.height,"M"+.495*b+" 0 L"+.505*b+" 0 L"+.52*b+" "+.73*a*this.needleLengthFactor+" L"+.48*b+" "+.73*a*this.needleLengthFactor+" Z"},b.prototype._getAngleByFactor=function(a){return d3.interpolate(this.opt.startAngle,this.opt.endAngle)(a)},b.prototype._getColorByFactor=function(a){return d3.interpolateRgb(this.opt.startColor,this.opt.endColor)(a)},b.prototype._set=function(a,b){this._value=a,null==b&&(b=this.opt.animationDuration),null!=this.color&&this.color.transition().duration(b).call(this.tween,this._value),this.opt.neelde||null==this.needle||this.needle.transition().duration(b).call(this.tweenNeedle,this._value)},b.prototype.tween=function(a,b){var c,d,e=this;c=this._getAngleByFactor(b),a.attrTween("d",function(a){var b;return b=d3.interpolate(e.color.datum().endAngle,e._angleToRad(c)),function(c){return a.endAngle=b(c),e.arc(a)}}),null==this.opt.fixedColor&&(d=this._getColorByFactor(b),a.attrTween("fill",function(){var a;return a=d3.interpolate(e.color.datum().fill,d),function(b){return d=a(b),e.color.datum().fill=d,d}}))},b.prototype.tweenNeedle=function(a,b){var c,d=this;c=this._getAngleByFactor(b),a.attrTween("transform",function(){var a;return a=d3.interpolate(d.needle.datum().angle,c),function(b){var c;return c=a(b),d.needle.datum().angle=c,"rotate("+c+" "+d.opt.height+" "+d.opt.height+")"}})},b}(b),null!=("undefined"!=typeof module&&null!==module?module.exports:void 0)?module.exports=c:(window.tcscharts||(window.tcscharts={}),window.tcscharts.Gauge=c)}.call(this),function(){var a,b,c,d=function(a,b){return function(){return a.apply(b,arguments)}},e={}.hasOwnProperty,f=function(a,b){function c(){this.constructor=a}for(var d in b)e.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};null!=("undefined"!=typeof module&&null!==module?module.exports:void 0)?(b=require("./base.js"),this.d3=require("d3")):b=window.tcscharts.Base,c=a=function(a){function b(a,c,e){var f;return this.target=a,this.data=null!=c?c:[],this._update=d(this._update,this),this.reset=d(this.reset,this),this.rem=d(this.rem,this),this.add=d(this.add,this),this.getData=d(this.getData,this),this._calcBarWidth=d(this._calcBarWidth,this),this.create=d(this.create,this),this.fnRect=d(this.fnRect,this),this._initOption=d(this._initOption,this),this._initOptions=d(this._initOptions,this),this._calcMetrics=d(this._calcMetrics,this),this.timeFormat=d(this.timeFormat,this),f=b.__super__.constructor.call(this,this.target),this._initOptions(e,!0),this._calcMetrics(),this.create(),this.customTimeFormat=this.timeFormat([[d3.time.format("%Y"),function(){return!0}],[d3.time.format("%B"),function(a){return a.getMonth()}],[d3.time.format("%b %d"),function(a){return 1!==a.getDate()}],[d3.time.format("%a %d"),function(a){return a.getDay()&&1!==a.getDate()}],[d3.time.format("%I %p"),function(a){return a.getHours()}],[d3.time.format("%I:%M"),function(a){return a.getMinutes()}],[d3.time.format(":%S"),function(a){return a.getSeconds()}],[d3.time.format(".%L"),function(a){return a.getMilliseconds()}]]),f}return f(b,a),b.prototype.defaults={timeKey:"ts",countKey:"count",width:700,height:300,margin:20,spacing:3,barsColor:"#718EE3",showCount:!0,countColorIn:"#fff",countColorOut:"#666",ticks:"minutes",tickFormat:"%I:%M",smallBarWidth:20,animationDuration:600},b.prototype.timeFormat=function(a){return function(b){var c,d;for(d=a.length-1,c=a[d];!c[1](b);)c=a[--d];return c[0](b)}},b.prototype._calcMetrics=function(){var a,b,c=this;null!=this.domainX&&(this._oldDomainX=this.domainX),a=function(){var a,c,d,e;for(d=this.data,e=[],a=0,c=d.length;c>a;a++)b=d[a],e.push(b[this.opt.timeKey]);return e}.call(this),this.domainX=[d3.min(a),d3.max(a)],this.domainY=[0,d3.max(this.data,function(a){return a[c.opt.countKey]})],this.interpolateX=d3.time.scale().domain(this.domainX),this.interpolateY=d3.scale.linear().range([0,this.opt.height-25]).domain(this.domainY),this._barWidth=this._calcBarWidth(),this.interpolateX.range([0,this.opt.width-this._barWidth]).tickFormat(this.customTimeFormat),this.xAxis=d3.svg.axis().scale(this.interpolateX).orient("bottom")},b.prototype._initOptions=function(a,b){var c;if(null==b&&(b=!1),b&&this._extend(this.opt={},this.defaults,a),b)for(c in this.opt)this._initOption(c)},b.prototype._initOption=function(a){var b,c=this;return b={get:function(){return c.opt[a]},set:function(b){switch(c.opt[a]=b,a){case"width":case"height":c.create();break;default:c.create()}}},this.define(a,b,this)},b.prototype.fnRect=function(a,b){var c=this;return null==a&&(a=!1),null==b&&(b=!1),function(d){var e,f;return d.attr("class","bar"),a?d.transition().duration(c.opt.animationDuration).attrTween("transform",function(a,d,e){var f,g,h,i,j,k,l,m;return i=e.slice(10,-1).split(","),j=i[0],k=i[1],h=b?0:c.interpolateY(a[c.opt.countKey]),l=c.interpolateX(new Date(a.ts)),m=c.opt.height-h-25,f=d3.interpolate(a._x||parseFloat(j),l),g=d3.interpolate(a._y||parseFloat(k),m),a._x=l,a._y=m,a._h=h,function(a){return"translate("+f(a)+","+g(a)+")"}}):d.datum(function(a){var b;return b=c.interpolateY(a[c.opt.countKey]),a._x=c.interpolateX(new Date(a.ts)),a._y=c.opt.height-b-25,a._h=b,a}).attr("transform",function(a){return"translate("+a._x+","+a._y+")"}),e=a?d.select("rect"):d.append("rect"),e.attr("fill",c.opt.barsColor),a?e.transition().duration(c.opt.animationDuration).attr("width",function(){return c._barWidth}).attr("height",function(a){return b?1e-6:c.interpolateY(a[c.opt.countKey])}):e.attr("width",function(){return c._barWidth}).attr("height",function(a){return b?1e-6:c.interpolateY(a[c.opt.countKey])}),c.opt.showCount&&(f=a?d.select("text"):d.append("text"),f.attr("class",function(){return c._barWidth>c.opt.smallBarWidth?"normal":"small"}).attr("transform",function(a){return a[c.opt.countKey]<.1*c.domainY[1]?"translate("+c._barWidth/2+",-5)":"translate("+c._barWidth/2+",15)"}).attr("fill",function(a){return a[c.opt.countKey]<.1*c.domainY[1]?c.opt.countColorOut:c.opt.countColorIn}).text(function(a){return a[c.opt.countKey]})),d}},b.prototype.create=function(){var a;a=d3.select(this.target),a.select("svg").remove(),this.svg=a.append("svg").attr("height",this.opt.height+2*this.opt.margin).attr("width",this.opt.width+2*this.opt.margin).append("g").attr("transform","translate("+this.opt.margin+","+this.opt.margin+")"),this.gxAxis=this.svg.append("g").attr("class","x axis").attr("transform","translate("+this._barWidth/2+","+(this.opt.height-20)+")").call(this.xAxis),this._update()},b.prototype._calcBarWidth=function(){var a;return a=this.interpolateX.ticks(d3.time[this.opt.ticks]).length,(this.opt.width-a*this.opt.spacing)/a},b.prototype.getData=function(){return this.data},b.prototype.add=function(a){this.data.push(a),this._calcMetrics(),this._update(!0)},b.prototype.rem=function(a){var b,c,d,e,f,g;for(g=!1,f=this.data,b=d=0,e=f.length;e>d;b=++d)if(c=f[b],c[this.opt.timeKey]===a){this.data.splice(b,1),g=!0;break}g&&(this._calcMetrics(),this._update(!0))},b.prototype.reset=function(a){this.data=a,this._calcMetrics(),this._update(!0)},b.prototype._update=function(a){var b,c=this;null==a&&(a=!1),this.bars=this.svg.selectAll(".bar").data(this.data,function(a){return a[c.opt.timeKey]}),a&&(this.gxAxis.transition().duration(this.opt.animationDuration).attr("transform","translate("+this._barWidth/2+","+(this.opt.height-20)+")").call(this.xAxis),this.bars.transition().duration(this.opt.animationDuration)),this.bars.enter().append("g").call(this.fnRect(!1)),this.bars.call(this.fnRect(!0)),b=this.bars.exit().call(this.fnRect(!0,!0)).remove()},b}(b),null!=("undefined"!=typeof module&&null!==module?module.exports:void 0)?module.exports=c:(window.tcscharts||(window.tcscharts={}),window.tcscharts.TimeBars=c)}.call(this);